<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>WebScraper.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">s0</a> &gt; <a href="index.source.html" class="el_package">edu.brown.cs.student.main.Business</a> &gt; <span class="el_source">WebScraper.java</span></div><h1>WebScraper.java</h1><pre class="source lang-java linenums">package edu.brown.cs.student.main.Business;

import com.squareup.moshi.JsonAdapter;
import com.squareup.moshi.Moshi;
import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.MalformedURLException;
import java.net.URL;
import java.net.URLEncoder;
import java.nio.charset.StandardCharsets;
import java.util.HashMap;
import java.util.List;
import okio.Buffer;
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.jsoup.select.Elements;

<span class="nc" id="L21">public class WebScraper {</span>
  private String key;

  private HashMap&lt;String, Double[]&gt; addressToCoordMap;

  public HashMap&lt;String, Double[]&gt; scrape() throws IOException {
<span class="nc" id="L27">    this.addressToCoordMap = new HashMap&lt;&gt;();</span>
<span class="nc" id="L28">    this.key = &quot;evtJ9UBqyUYofFNw5qmUmnAu8U6Dv5Xz&quot;;</span>
<span class="nc" id="L29">    String url =</span>
        &quot;https://www.boston.com/community/readers-say/aapi-and-asian-owned-businesses-to-shop-support-in-greater-boston/&quot;;
<span class="nc" id="L31">    URL obj = new URL(url);</span>
<span class="nc" id="L32">    HttpURLConnection con = (HttpURLConnection) obj.openConnection();</span>
<span class="nc" id="L33">    con.setRequestProperty(&quot;User-Agent&quot;, &quot;Mozilla/5.0&quot;);</span>
<span class="nc" id="L34">    int responseCode = con.getResponseCode();</span>
<span class="nc" id="L35">    System.out.println(&quot;Response code: &quot; + responseCode);</span>
<span class="nc" id="L36">    BufferedReader in = new BufferedReader(new InputStreamReader(con.getInputStream()));</span>
    String inputLine;
<span class="nc" id="L38">    StringBuilder response = new StringBuilder();</span>
<span class="nc bnc" id="L39" title="All 2 branches missed.">    while ((inputLine = in.readLine()) != null) {</span>
<span class="nc" id="L40">      response.append(inputLine);</span>
    }
<span class="nc" id="L42">    in.close();</span>
<span class="nc" id="L43">    String html = response.toString();</span>
<span class="nc" id="L44">    Document doc = Jsoup.parse(html);</span>
<span class="nc" id="L45">    Elements names = doc.select(&quot;h3.wp-block-heading&quot;);</span>
<span class="nc bnc" id="L46" title="All 2 branches missed.">    for (Element name : names) {</span>
<span class="nc" id="L47">      String href = name.text(); // returns the restaurant names</span>
      //      System.out.println(href);
<span class="nc" id="L49">      Element addressElement = name.nextElementSibling();</span>
<span class="nc bnc" id="L50" title="All 2 branches missed.">      if (addressElement != null) {</span>
<span class="nc" id="L51">        Element addressEl = addressElement.selectFirst(&quot;em&quot;);</span>
<span class="nc bnc" id="L52" title="All 2 branches missed.">        if (addressEl != null) {</span>
<span class="nc" id="L53">          String unfiltAddress = addressEl.text();</span>
<span class="nc" id="L54">          String[] splitAddress = unfiltAddress.split(&quot;;&quot;);</span>
<span class="nc" id="L55">          String address = splitAddress[0];</span>
<span class="nc" id="L56">          System.out.println(address);</span>
          try {
<span class="nc" id="L58">            String encodedAddress = URLEncoder.encode(address, StandardCharsets.UTF_8);</span>

<span class="nc" id="L60">            URL requestURL =</span>
                new URL(
                    &quot;https://www.mapquestapi.com/geocoding/v1/address?key=&quot;
                        + this.key
                        + &quot;&amp;location=&quot;
                        + encodedAddress);

<span class="nc" id="L67">            HttpURLConnection clientConnection = (HttpURLConnection) requestURL.openConnection();</span>
<span class="nc" id="L68">            clientConnection.setRequestMethod(&quot;GET&quot;);</span>
<span class="nc bnc" id="L69" title="All 2 branches missed.">            if (clientConnection.getResponseCode() != 200) {</span>
<span class="nc" id="L70">              throw new MalformedURLException();</span>
            }
<span class="nc" id="L72">            Moshi moshi = new Moshi.Builder().build();</span>
<span class="nc" id="L73">            JsonAdapter&lt;GeocodingResponse&gt; adapter = moshi.adapter(GeocodingResponse.class);</span>
<span class="nc" id="L74">            GeocodingResponse geocodingResponse =</span>
<span class="nc" id="L75">                adapter.fromJson(new Buffer().readFrom(clientConnection.getInputStream()));</span>
<span class="nc" id="L76">            Double lat = geocodingResponse.results().get(0).locations().get(0).latLng().lat();</span>
<span class="nc" id="L77">            Double lng = geocodingResponse.results().get(0).locations().get(0).latLng().lng();</span>
<span class="nc" id="L78">            Double[] coords = new Double[2];</span>
<span class="nc" id="L79">            coords[0] = lat;</span>
<span class="nc" id="L80">            coords[1] = lng;</span>
<span class="nc" id="L81">            this.addressToCoordMap.put(address, coords);</span>

<span class="nc" id="L83">          } catch (Exception e) {</span>
<span class="nc" id="L84">            System.out.println(e.getMessage());</span>
<span class="nc" id="L85">          }</span>
        }
      }
<span class="nc" id="L88">    }</span>
<span class="nc" id="L89">    return this.addressToCoordMap;</span>
  }

<span class="nc" id="L92">  public void yelpAPICall() {}</span>

<span class="nc" id="L94">  public record GeocodingResponse(Info info, Options options, List&lt;Result&gt; results) {}</span>

<span class="nc" id="L96">  public record Info(int statuscode, Copyright copyright, List&lt;String&gt; messages) {}</span>

<span class="nc" id="L98">  public record Copyright(String text, String imageUrl, String imageAltText) {}</span>

<span class="nc" id="L100">  public record Options(int maxResults, boolean ignoreLatLngInput) {}</span>

<span class="nc" id="L102">  public record Result(ProvidedLocation providedLocation, List&lt;Location&gt; locations) {}</span>

<span class="nc" id="L104">  public record ProvidedLocation(String location) {}</span>

<span class="nc" id="L106">  public record Location(</span>
      String street,
      String adminArea6,
      String adminArea6Type,
      String adminArea5,
      String adminArea5Type,
      String adminArea4,
      String adminArea4Type,
      String adminArea3,
      String adminArea3Type,
      String adminArea1,
      String adminArea1Type,
      String postalCode,
      String geocodeQualityCode,
      String geocodeQuality,
      boolean dragPoint,
      String sideOfStreet,
      String linkId,
      String unknownInput,
      String type,
      LatLng latLng,
      LatLng displayLatLng,
      String mapUrl) {}

<span class="nc" id="L130">  public record LatLng(double lat, double lng) {}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>